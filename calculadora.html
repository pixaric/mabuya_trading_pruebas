<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mabuya Trading - Calculadora</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración de Tailwind para un tema oscuro y fuente Inter -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#121212',
                        'secondary-dark': '#1e1e1e',
                        'accent-gold': '#ffc107',
                        'accent-blue': '#007bff',
                        'calc-red': '#ef4444',
                        'calc-green': '#10b981',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Estilo para el enlace activo */
        .active-link {
            border-bottom: 2px solid #ffc107;
            color: #ffc107 !important;
        }
        /* Estilos de la calculadora para el foco */
        input:focus {
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.5);
            border-color: #ffc107 !important;
        }
        /* Aumento de la fuente base para todo el cuerpo */
        body {
            font-size: 1.125rem; /* text-lg: 18px */
        }
        /* Ajuste de inputs y botones para mejor legibilidad */
        input, button, select {
            font-size: 1.125rem; /* text-lg: 18px */
        }
    </style>
</head>
<body class="bg-primary-dark text-gray-100 font-sans min-h-screen pt-24 sm:pt-28">
    <!-- Aumento de padding superior por el tamaño de la barra de navegación aumentada -->

    <!-- ========================================================= -->
    <!-- BARRA DE NAVEGACIÓN Y RELOJ FIJO JUNTOS -->
    <!-- ========================================================= -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-secondary-dark shadow-xl">
        <!-- Contenedor principal de navegación -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20"> <!-- Altura aumentada -->
                <!-- Logo -->
                <a href="inicio.html" class="text-3xl font-bold tracking-wider text-accent-gold transition duration-300 hover:text-white"> <!-- text-3xl -->
                    MABUYA <span class="text-white">TRADING</span>
                </a>
                
                <!-- Menú de Navegación (Desktop) - Calculadora Activa -->
                <nav class="hidden md:flex space-x-10"> <!-- Espacio aumentado -->
                    <a href="inicio.html" class="nav-link text-gray-300 hover:text-accent-gold transition duration-150 py-3 text-lg border-b-2 border-transparent hover:border-accent-gold">Inicio</a>
                    <a href="academia.html" class="nav-link text-gray-300 hover:text-accent-gold transition duration-150 py-3 text-lg border-b-2 border-transparent hover:border-accent-gold">Academia</a>
                    <a href="videos.html" class="nav-link text-gray-300 hover:text-accent-gold transition duration-150 py-3 text-lg border-b-2 border-transparent hover:border-accent-gold">Videos</a>
                    <!-- Calculadora está activa -->
                    <a href="calculadora.html" class="nav-link active-link text-gray-300 transition duration-150 py-3 text-lg border-b-2 border-transparent hover:border-accent-gold">Calculadora</a>
                </nav>

                <!-- Botón de Menú Móvil -->
                <button id="mobile-menu-button" class="md:hidden text-gray-300 hover:text-accent-gold focus:outline-none p-2 rounded-md" aria-label="Toggle Menu">
                    <!-- Icono de Hamburguesa (SVG) -->
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
        </div>
        
        <!-- Menú Móvil Desplegable -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="inicio.html" class="block px-3 py-2 rounded-md text-xl font-medium text-gray-300 hover:bg-accent-gold/20">Inicio</a>
                <a href="academia.html" class="block px-3 py-2 rounded-md text-xl font-medium text-gray-300 hover:bg-accent-gold/20">Academia</a>
                <a href="videos.html" class="block px-3 py-2 rounded-md text-xl font-medium text-gray-300 hover:bg-accent-gold/20">Videos</a>
                <a href="calculadora.html" class="block px-3 py-2 rounded-md text-xl font-medium text-white bg-accent-blue/20 hover:bg-accent-gold/20 active-link">Calculadora</a>
            </div>
        </div>
        
        <!-- ========================================================= -->
        <!-- PANEL DE RELOJ (Compacto en una sola línea, debajo del menú) -->
        <!-- ========================================================= -->
        <div class="bg-primary-dark border-t border-gray-700 p-2 sm:p-3 shadow-inner">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row justify-center sm:justify-between items-center space-y-2 sm:space-y-0 sm:space-x-6">
                
                <!-- Contenedor de Relojes en una sola línea (mobile/desktop) -->
                <div class="flex flex-row items-center space-x-6">
                    
                    <!-- 1. Hora NYSE -->
                    <div class="flex items-center space-x-2 text-base text-gray-300">
                        <span class="font-bold text-accent-gold hidden sm:inline text-lg">NYSE (ET):</span>
                        <span class="font-bold text-accent-gold sm:hidden text-lg">NYSE:</span>
                        <span id="nyseClock" class="font-mono text-xl sm:text-2xl text-white">00:00:00</span>
                    </div>
                    
                    <!-- Separador (Solo visible en desktop) -->
                    <div class="hidden sm:block w-px h-8 bg-gray-700"></div>

                    <!-- 2. Estado de la Bolsa (TEMPORIZADOR) -->
                    <div class="flex items-center space-x-2">
                        <!-- El texto y color se actualizan dinámicamente -->
                        <span id="marketStatus" class="font-bold text-white text-xl sm:text-2xl">Cargando...</span>
                    </div>
                    
                    <!-- Separador (Solo visible en desktop) -->
                    <div class="hidden sm:block w-px h-8 bg-gray-700"></div>

                    <!-- 3. Hora Local -->
                    <div class="flex items-center space-x-2 text-base text-gray-300">
                        <span class="font-bold hidden sm:inline text-lg">Hora Local:</span>
                        <span class="font-bold sm:hidden text-lg">Local:</span>
                        <span id="localClock" class="font-mono text-xl sm:text-2xl text-white">00:00:00</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-12">

        <!-- Sección 1: Calculadora de Porcentaje (Target Price) -->
        <section class="pt-4">
            <h1 class="text-4xl sm:text-5xl font-bold text-center text-accent-blue mb-4">Calculadora de Porcentaje</h1>
            <p class="text-gray-400 mb-8 text-center max-w-xl mx-auto text-lg">Calcula el precio de venta (Take Profit) y el capital total invertido para la operación.</p>

            <!-- CAMBIO: max-w-3xl para PC -->
            <div class="bg-secondary-dark p-6 md:p-12 rounded-2xl shadow-2xl max-w-sm sm:max-w-md md:max-w-3xl mx-auto">
                
                <!-- Inputs for Markup Calculator: Organizado en 2x2 grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    
                    <!-- 1. Precio de Entrada -->
                    <div>
                        <label for="purchasePrice" class="block text-lg font-medium text-gray-300 mb-2">Precio de Entrada ($)</label>
                        <input type="number" id="purchasePrice" value="" step="0.0001" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateMarkup()">
                    </div>

                    <!-- 2. Ganancia Objetivo (%) -->
                    <div>
                        <label for="markupPercent" class="block text-lg font-medium text-gray-300 mb-2">Ganancia Objetivo (%)</label>
                        <input type="number" id="markupPercent" value="" step="0.01" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateMarkup()">
                    </div>
                    
                    <!-- 3. Cantidad de Acciones -->
                    <div>
                        <label for="sharesQuantity" class="block text-lg font-medium text-gray-300 mb-2">Cantidad de Acciones</label>
                        <input type="number" id="sharesQuantity" value="" step="1" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateMarkup()">
                    </div>
                    
                </div>

                <!-- Results for Markup Calculator -->
                <div class="border-t border-gray-700 pt-8 mt-4 grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- Precio de Venta Calculado (Mayor énfasis) -->
                    <div class="md:col-span-2 flex justify-between items-center p-5 sm:p-6 bg-primary-dark rounded-xl shadow-inner border border-accent-blue">
                        <span class="text-xl sm:text-2xl font-semibold text-gray-300">Precio de Venta (TP):</span>
                        <!-- Aumento de tamaño de fuente para el resultado clave -->
                        <span id="outputSellingPrice" class="text-3xl sm:text-5xl font-extrabold text-accent-gold">0.00</span>
                    </div>
                    
                    <!-- Total Invertido -->
                    <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner border border-accent-gold/50">
                        <span class="text-base text-gray-400">Total Invertido:</span>
                        <span id="outputTotalInvestmentMarkup" class="text-xl sm:text-2xl font-bold text-white">$0.00</span>
                    </div>
                    
                    <!-- Incremento Absoluto ($) -->
                    <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner border border-gray-700 md:col-span-1">
                        <span class="text-base text-gray-400">Incremento Absoluto:</span>
                        <span id="outputGrossProfit" class="text-xl sm:text-2xl font-bold text-calc-green">0.00</span>
                    </div>

                </div>
            </div>
        </section>

        <!-- Sección 2: Calculadora de Precio Promedio Ponderado -->
        <section class="pt-10 mt-12 border-t border-gray-700">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-accent-gold mb-5">Calculadora de Posición Promedio</h2>
            <p class="text-gray-400 mb-8 text-center max-w-3xl mx-auto text-lg">Calcula el precio promedio de tu posición combinada (DCA).</p>
            
            <!-- CAMBIO: max-w-3xl para PC -->
            <div class="bg-secondary-dark p-6 md:p-12 rounded-2xl shadow-2xl max-w-sm sm:max-w-md md:max-w-3xl mx-auto">
                
                <!-- Encabezados de la tabla de posiciones: gap-4 en desktop -->
                <div class="grid grid-cols-4 gap-6 text-lg font-semibold text-gray-300 mb-4 border-b border-gray-700 pb-3">
                    <span class="col-span-1 text-accent-gold">Posición</span>
                    <span class="col-span-1 text-center">Precio ($)</span>
                    <span class="col-span-1 text-center">Acciones</span>
                    <span class="col-span-1 text-right">Invertido ($)</span>
                </div>

                <!-- Fila 1: Compra 1 -->
                <div class="grid grid-cols-4 gap-6 items-center mb-4">
                    <span class="col-span-1 text-lg">Compra 1</span>
                    <input type="number" id="price1" value="" step="0.01" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <input type="number" id="shares1" value="" step="1" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <span id="invested1" class="col-span-1 text-right text-gray-400 text-lg">$0.00</span>
                </div>

                <!-- Fila 2: Compra 2 -->
                <div class="grid grid-cols-4 gap-6 items-center mb-4">
                    <span class="col-span-1 text-lg">Compra 2</span>
                    <input type="number" id="price2" value="" step="0.01" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <input type="number" id="shares2" value="" step="1" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <span id="invested2" class="col-span-1 text-right text-gray-400 text-lg">$0.00</span>
                </div>
                
                <!-- Fila 3: Compra 3 -->
                <div class="grid grid-cols-4 gap-6 items-center mb-6">
                    <span class="col-span-1 text-lg">Compra 3</span>
                    <input type="number" id="price3" value="" step="0.01" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <input type="number" id="shares3" value="" step="1" class="col-span-1 w-full p-3 bg-primary-dark border border-gray-600 rounded-xl text-white text-center" oninput="calculateDCA()">
                    <span id="invested3" class="col-span-1 text-right text-gray-400 text-lg">$0.00</span>
                </div>

                <!-- Resultados Totales -->
                <div class="border-t border-gray-600 pt-8 mt-4 space-y-4">
                    
                    <!-- Precio Promedio -->
                    <div class="flex justify-between items-center p-5 bg-primary-dark rounded-xl shadow-inner border border-accent-gold/50">
                        <span class="text-xl sm:text-2xl font-semibold text-gray-300">Precio Promedio:</span>
                        <!-- Aumento de tamaño de fuente para el resultado clave -->
                        <span id="outputAvgPrice" class="text-3xl sm:text-4xl font-extrabold text-accent-gold">$0.00</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6">
                        <!-- Acciones Totales -->
                        <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner">
                            <span class="text-base text-gray-300">Total de Unidades:</span>
                            <span id="outputTotalShares" class="text-xl sm:text-2xl font-bold text-white">0</span>
                        </div>

                        <!-- Capital Total Invertido -->
                        <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner">
                            <span class="text-base text-gray-300">Capital Total ($):</span>
                            <span id="outputTotalInvested" class="text-xl sm:text-2xl font-bold text-calc-green">$0.00</span>
                        </div>
                    </div>

                </div>
            </div>
        </section>
        
        <!-- Sección 3: Calculadora de Posiciones de Opciones -->
        <section class="pt-10 mt-12 border-t border-gray-700">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-accent-blue mb-5">Calculadora de Opciones</h2>
            <p class="text-gray-400 mb-8 text-center max-w-3xl mx-auto text-lg">Calcula la inversión, el beneficio neto y el precio de venta (premium) objetivo.</p>
            
            <!-- CAMBIO: max-w-3xl para PC -->
            <div class="bg-secondary-dark p-6 md:p-12 rounded-2xl shadow-2xl max-w-sm sm:max-w-md md:max-w-3xl mx-auto border-2 border-accent-blue/50">
                
                <!-- Inputs for Options Calculator: Ahora en grid 2x2 también para PC, con p-3 para más espacio -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mb-8">
                    
                    <!-- Precio (Premium) -->
                    <div>
                        <label for="optionPrice" class="block text-lg font-medium text-gray-300 mb-2">Precio de Opción (Premium $)</label>
                        <input type="number" id="optionPrice" value="" step="0.01" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateOptionsPosition()">
                    </div>

                    <!-- Cantidad de Contratos -->
                    <div>
                        <label for="optionContracts" class="block text-lg font-medium text-gray-300 mb-2">Cantidad de Contratos</label>
                        <input type="number" id="optionContracts" value="" step="1" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateOptionsPosition()">
                    </div>

                    <!-- Porcentaje de Ganancia Objetivo (Valor por defecto 12) -->
                    <div>
                        <label for="optionTargetPercent" class="block text-lg font-medium text-gray-300 mb-2">Ganancia Objetivo (%)</label>
                        <input type="number" id="optionTargetPercent" value="12" step="1" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateOptionsPosition()">
                    </div>
                    
                    <!-- Comisión por Contrato (Default 2) -->
                    <div>
                        <label for="optionCommission" class="block text-lg font-medium text-gray-300 mb-2">Comisión por Contrato ($)</label>
                        <input type="number" id="optionCommission" value="2" step="0.01" class="w-full p-4 bg-primary-dark border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent-gold transition" oninput="calculateOptionsPosition()">
                    </div>
                    
                </div>

                <!-- Results for Options Calculator: Ahora en grid 3x1 -->
                <div class="border-t border-gray-700 pt-8 mt-4 space-y-4">
                    
                    <!-- Precio de Venta Objetivo (Output 2) -->
                    <div class="flex justify-between items-center p-5 sm:p-6 bg-primary-dark rounded-xl shadow-inner border border-calc-green/50">
                        <span class="text-xl sm:text-2xl font-semibold text-gray-300">Precio Venta Objetivo:</span>
                        <!-- Aumento de tamaño de fuente para el resultado clave -->
                        <span id="outputTargetSellingPrice" class="text-3xl sm:text-5xl font-extrabold text-calc-green">0.00</span>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <!-- Inversión Total (Output 1) -->
                        <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner border border-calc-red/50">
                            <span class="text-base text-gray-400">Capital Total:</span>
                            <span id="outputTotalInvestment" class="text-xl sm:text-2xl font-extrabold text-calc-red">$0.00</span>
                        </div>

                        <!-- Beneficio Neto Objetivo -->
                        <div class="flex flex-col justify-center p-4 bg-primary-dark rounded-xl shadow-inner border border-calc-green/50">
                            <span class="text-base text-gray-400">Beneficio Neto Obj.:</span>
                            <span id="outputNetProfit" class="text-xl sm:text-2xl font-extrabold text-calc-green">$0.00</span>
                        </div>
                    </div>
                    
                </div>

            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-secondary-dark mt-12 p-8 text-center text-lg text-gray-400">
        <p>&copy; 2025 Mabuya Trading. Todos los derechos reservados. Educando la próxima generación de traders.</p>
    </footer>

    <script>
        // Lógica de JavaScript para la Navegación Móvil
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // =========================================================
        // FUNCIÓN UTILITARIA PARA FORMATO DE TIEMPO (HH:MM:SS)
        // =========================================================
        function formatTimeDifference(ms) {
            if (ms <= 0) return "00:00:00";
            
            let seconds = Math.floor(ms / 1000);
            const hours = Math.floor(seconds / 3600);
            seconds %= 3600;
            const minutes = Math.floor(seconds / 60);
            seconds %= 60;

            const pad = (num) => String(num).padStart(2, '0');
            return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
        }
        
        // =========================================================
        // LÓGICA DEL RELOJ Y ESTADO DE LA BOLSA (ACTUALIZADA A TEMPORIZADOR Y FESTIVOS)
        // =========================================================

        /**
         * Verifica si la fecha actual (en hora ET) es un día festivo de NYSE.
         * Se incluyen los festivos principales de 2025.
         * @param {Date} nyseDate - Objeto Date ajustado a la zona horaria de NYSE.
         * @returns {boolean} True si es festivo, false en caso contrario.
         */
        function isNYSEHoliday(nyseDate) {
            const year = nyseDate.getFullYear();
            // Formato YYYY-MM-DD para comparación sencilla de fechas
            const month = String(nyseDate.getMonth() + 1).padStart(2, '0');
            const day = String(nyseDate.getDate()).padStart(2, '0');
            const dateString = `${year}-${month}-${day}`;

            // Días festivos de NYSE para 2025 (cierre completo)
            const holidays = [
                `${year}-01-01`, // Día de Año Nuevo
                `${year}-01-20`, // Día de MLK Jr.
                `${year}-02-17`, // Día de los Presidentes
                `${year}-04-18`, // Viernes Santo
                `${year}-05-26`, // Día de los Caídos
                `${year}-06-19`, // Día de Juneteenth
                `${year}-07-04`, // Día de la Independencia
                `${year}-09-01`, // Día del Trabajo
                `${year}-11-27`, // Día de Acción de Gracias
                `${year}-12-25`, // Día de Navidad
            ];

            return holidays.includes(dateString);
        }

        function updateClocksAndStatus() {
            const now = new Date();
            const nyseClock = document.getElementById('nyseClock');
            const localClock = document.getElementById('localClock');
            const marketStatus = document.getElementById('marketStatus');

            // Formato de hora estándar
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            };

            // 1. Hora Local
            const localTime = now.toLocaleTimeString('es-ES', timeOptions);
            localClock.textContent = localTime;

            // 2. Hora NYSE (America/New_York - Hora del Este)
            const nyseTime = now.toLocaleTimeString('en-US', { ...timeOptions, timeZone: 'America/New_York', hour12: false });
            nyseClock.textContent = nyseTime;

            // 3. Calcular Estado de la Bolsa (NYSE) con Temporizador
            
            // Obtener la fecha y hora actual en la zona horaria de NYSE
            const nyseDate = new Date(now.toLocaleString("en-US", { timeZone: "America/New_York" }));
            const nyseDateMs = nyseDate.getTime();
            const currentNYSEDOW = nyseDate.getDay(); // Domingo=0, Lunes=1, ... Sábado=6

            // Crear objetos Date para la apertura (9:30 ET) y el cierre (4:00 PM ET) de HOY
            const nyseOpenToday = new Date(nyseDate);
            nyseOpenToday.setHours(9, 30, 0, 0); 

            const nyseCloseToday = new Date(nyseDate);
            nyseCloseToday.setHours(16, 0, 0, 0); 
            
            let statusText = '';
            let statusColorClass = '';
            
            // Días de la semana de negociación: Lunes (1) a Viernes (5)
            const isTradingDay = currentNYSEDOW >= 1 && currentNYSEDOW <= 5;
            const isHoliday = isNYSEHoliday(nyseDate); // Chequeo de días festivos
            
            if (!isTradingDay || isHoliday) {
                // Fin de semana O Día Festivo
                if (!isTradingDay) {
                    // Fin de semana
                    statusText = 'CERRADA (Fin de Semana)';
                    statusColorClass = 'text-gray-500';
                } else {
                    // Día festivo (es un día de la semana, pero está cerrada)
                    statusText = 'CERRADA (Día Festivo)';
                    statusColorClass = 'text-calc-red'; // Rojo para cerrado por festivo
                }
            } else {
                // Es un día de negociación y no es festivo
                const openTimeMs = nyseOpenToday.getTime();
                const closeTimeMs = nyseCloseToday.getTime();

                if (nyseDateMs < openTimeMs) {
                    // CERRADA: Contando hasta la Apertura
                    const timeToOpenMs = openTimeMs - nyseDateMs;
                    const countdown = formatTimeDifference(timeToOpenMs);
                    
                    statusText = `Abre en: ${countdown}`;
                    statusColorClass = 'text-calc-red'; // Rojo para apertura
                } else if (nyseDateMs >= openTimeMs && nyseDateMs < closeTimeMs) {
                    // ABIERTA: Contando hasta el Cierre
                    const timeToCloseMs = closeTimeMs - nyseDateMs;
                    const countdown = formatTimeDifference(timeToCloseMs);

                    statusText = `Cierra en: ${countdown}`;
                    statusColorClass = 'text-calc-green'; // Verde para cierre
                } else {
                    // CERRADA: Después del Cierre
                    statusText = 'CERRADA';
                    statusColorClass = 'text-calc-red'; // Rojo para cerrada
                }
            }
            
            // Actualizar el elemento de estado
            marketStatus.textContent = statusText;
            // Asegurarse de que el tamaño de fuente se mantenga para el estado de la bolsa
            marketStatus.className = `font-bold text-xl sm:text-2xl ${statusColorClass}`;
        }


        // =========================================================
        // LÓGICA DE NAVEGACIÓN RÁPIDA (ENTER KEY)
        // =========================================================

        function setupNavigation() {
            // Definición del orden de los inputs por sección
            const markupInputs = ['purchasePrice', 'markupPercent', 'sharesQuantity'];
            const dcaInputs = ['price1', 'shares1', 'price2', 'shares2', 'price3', 'shares3'];
            const optionsInputs = ['optionPrice', 'optionContracts', 'optionTargetPercent', 'optionCommission'];

            // Combinar todos los arrays para facilitar el manejo
            const allInputIds = [...markupInputs, ...dcaInputs, ...optionsInputs];

            allInputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('keydown', (event) => {
                        // Solo actuar cuando se presiona la tecla Enter
                        if (event.key === 'Enter') {
                            event.preventDefault(); // Evitar el comportamiento por defecto (e.g., submit)

                            let currentInputs;
                            // Determinar a qué grupo pertenece el input actual
                            if (markupInputs.includes(id)) {
                                currentInputs = markupInputs;
                            } else if (dcaInputs.includes(id)) {
                                currentInputs = dcaInputs;
                            } else if (optionsInputs.includes(id)) {
                                currentInputs = optionsInputs;
                            }
                            
                            if (currentInputs) {
                                const currentIndex = currentInputs.indexOf(id);
                                // Calcular el índice del siguiente input. Usamos el operador % para hacer un loop.
                                const nextIndex = (currentIndex + 1) % currentInputs.length;
                                const nextInputId = currentInputs[nextIndex];
                                
                                // Mover el foco al siguiente input
                                const nextInput = document.getElementById(nextInputId);
                                if (nextInput) {
                                    nextInput.focus();
                                    // Seleccionar todo el texto para facilitar la sobreescritura
                                    nextInput.select();
                                }
                            }
                        }
                    });
                }
            });
        }
        
        // =========================================================
        // LÓGICA DE CÁLCULO
        // =========================================================

        // Lógica de JavaScript para la Calculadora de Porcentaje (Markup)
        function calculateMarkup() {
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const markupPercent = parseFloat(document.getElementById('markupPercent').value) || 0;
            const sharesQuantity = parseInt(document.getElementById('sharesQuantity').value) || 0; 
            
            const outputSellingPrice = document.getElementById('outputSellingPrice');
            const outputGrossProfit = document.getElementById('outputGrossProfit');
            const outputTotalInvestmentMarkup = document.getElementById('outputTotalInvestmentMarkup');
            
            if (purchasePrice <= 0 && sharesQuantity === 0) {
                outputSellingPrice.textContent = '0.00';
                outputGrossProfit.textContent = '0.00';
                outputTotalInvestmentMarkup.textContent = '$0.00';
                return;
            }

            // 1. Calcular Precio de Venta
            const sellingPrice = purchasePrice * (1 + markupPercent / 100);
            
            // 2. Calcular Incremento Absoluto (Diferencia) - 2 decimales
            const priceDifference = sellingPrice - purchasePrice;

            // 3. Calcular Total Invertido: Precio de Entrada * Cantidad de Acciones
            const totalInvestment = purchasePrice * sharesQuantity;

            // 4. Actualizar Outputs
            outputSellingPrice.textContent = sellingPrice.toFixed(2);
            outputGrossProfit.textContent = priceDifference.toFixed(2);
            outputTotalInvestmentMarkup.textContent = `$${totalInvestment.toFixed(2)}`;
        }
        
        // Lógica de JavaScript para la Calculadora de Precio Promedio Ponderado (DCA)
        function calculateDCA() {
            const prices = [
                parseFloat(document.getElementById('price1').value) || 0,
                parseFloat(document.getElementById('price2').value) || 0,
                parseFloat(document.getElementById('price3').value) || 0
            ];
            const shares = [
                parseFloat(document.getElementById('shares1').value) || 0,
                parseFloat(document.getElementById('shares2').value) || 0,
                parseFloat(document.getElementById('shares3').value) || 0
            ];
            
            let totalInvested = 0;
            let totalShares = 0;

            // Calcular Invertido por Posición
            for (let i = 0; i < 3; i++) {
                const invested = prices[i] * shares[i];
                document.getElementById(`invested${i + 1}`).textContent = `$${invested.toFixed(2)}`;
                
                totalInvested += invested;
                totalShares += shares[i];
            }
            
            // Calcular Precio Promedio Ponderado
            let averagePrice = 0;
            if (totalShares > 0) {
                averagePrice = totalInvested / totalShares;
            }

            // Actualizar Outputs
            document.getElementById('outputAvgPrice').textContent = `$${averagePrice.toFixed(2)}`;
            document.getElementById('outputTotalShares').textContent = totalShares.toFixed(0);
            document.getElementById('outputTotalInvested').textContent = `$${totalInvested.toFixed(2)}`;
        }
        
        // Lógica de JavaScript para la Calculadora de Opciones
        function calculateOptionsPosition() {
            const price = parseFloat(document.getElementById('optionPrice').value) || 0;
            const contracts = parseInt(document.getElementById('optionContracts').value) || 0;
            const commission = parseFloat(document.getElementById('optionCommission').value) || 0;
            const targetPercent = parseFloat(document.getElementById('optionTargetPercent').value) || 0;

            const outputTotalInvestment = document.getElementById('outputTotalInvestment');
            const outputNetProfit = document.getElementById('outputNetProfit'); 
            const outputTargetSellingPrice = document.getElementById('outputTargetSellingPrice');

            const sharesPerContract = 100;

            if (price <= 0 || contracts <= 0) {
                outputTotalInvestment.textContent = '$0.00';
                outputNetProfit.textContent = '$0.00'; 
                outputTargetSellingPrice.textContent = '0.00';
                return;
            }

            // Costo por Contrato (Premium * 100 + Comisión de Entrada)
            const costPerContract = (price * sharesPerContract) + commission;

            // Inversión Total
            const totalInvestment = costPerContract * contracts;
            
            // Ganancia Bruta Deseada
            const grossProfitNeeded = totalInvestment * (targetPercent / 100);

            // Comisión Total (Entrada + Salida)
            const totalCommissions = 2 * commission * contracts;
            
            // Beneficio Neto Objetivo
            const netProfit = grossProfitNeeded - totalCommissions; 

            // Valor de Venta Total (Inversión + Ganancia Bruta Necesaria)
            const totalSellingValue = totalInvestment + grossProfitNeeded;
            
            // Precio de Venta por Contrato
            const sellingPricePerContract = totalSellingValue / contracts;
            
            // Precio Venta de la Opción (Premium)
            const targetSellingPrice = (sellingPricePerContract - commission) / sharesPerContract;

            // Actualizar Outputs
            outputTotalInvestment.textContent = `$${totalInvestment.toFixed(2)}`;
            outputNetProfit.textContent = `$${netProfit.toFixed(2)}`; 
            outputTargetSellingPrice.textContent = targetSellingPrice.toFixed(2);
        }


        // Ejecutar las funciones al cargar la página para inicializar los valores y la navegación
        window.onload = function() {
            calculateMarkup(); 
            calculateDCA();
            calculateOptionsPosition(); 
            setupNavigation(); // Configura la navegación con Enter
            
            // Inicia y actualiza los relojes y el estado de la bolsa cada segundo
            updateClocksAndStatus();
            // Actualiza el reloj y el estado de la bolsa cada segundo (1000ms)
            setInterval(updateClocksAndStatus, 1000); 
        };
    </script>
</body>
</html>